<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prices For Procedures</title>
  <link rel="stylesheet" href="main.css">
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f4f4f4;
    }

    .result-count {
      margin-top: 10px;
      font-weight: bold;
    }

    header {
      display: flex;         
      justify-content: space-between;
      align-items: center;  
      padding: 20px;
    }

    .header-link { 
    color:rgb(255, 255, 255);  
    font-size: 16px;
    padding: 20px;
    }

    .header-link:hover {
      text-decoration: underline;  /* Underline the link on hover */
      color:rgb(140, 140, 140);              /* Change the color when hovered (optional) */
    }
  </style>
</head>
<body>
  <header>
    <h1>Prices For Procedures</h1>
    <a href="about_us.html" class="header-link">About Us</a> <!-- Link in top-right -->
  </header>

  <main>
    <!-- Search Feature -->
    <section class="search">
      <h2>Search</h2>
      <form id="searchForm">
        <input type="text" name="query" id="query" placeholder="Search here..." required>
        <button type="submit">Search</button>
      </form>

      <!-- Result Count -->
      <p id="resultCount" class="result-count">Results found: 0</p>

      <!-- Table to display search results -->
      <div id="results-container">
        <table id="results-table">
          <thead>
            <tr>
              <th>Hospital Name</th>
              <th>Hospital Address</th>
              <th>Description</th>
              <th>Gross Charge</th>
              <th>Discounted Cash</th>
              <th>Billing Class</th>
              <th>Notes</th>
              <th>Gross Charge Types</th>
            </tr>
          </thead>
          <tbody>
            <!-- Search results will appear here -->
          </tbody>
        </table>
      </div>
    </section>
  </main>
  
  <footer>
    <p>&copy; 2024 Prices For Procedures</p>
  </footer>

  <script>
  const searchForm = document.getElementById('searchForm');
const queryInput = document.getElementById('query');
const resultsTableBody = document.querySelector('#results-table tbody');
const resultCount = document.getElementById('resultCount'); // Result count element

async function fetchData() {
  try {
    const response = await fetch('data.json');
    const data = await response.json();
    return data; // No 'hospitals' key; it's an array directly
  } catch (error) {
    console.error('Error fetching data:', error);
    return [];
  }
}

async function displayResults(query) {
  resultsTableBody.innerHTML = ''; 
  resultCount.textContent = 'Results found: 0';

  const data = await fetchData();
  if (!Array.isArray(data)) return; // Ensure data is an array

  let totalResults = 0; // Count results across all hospitals

  data.forEach(hospital => { // Loop over hospital objects
    const hospitalName = hospital.name;
    const hospitalAddress = hospital.addr;

    // Filter charges for this hospital
    const filteredCharges = hospital.charges.filter(item =>
      item.desc.toLowerCase().includes(query.toLowerCase())
    );

    totalResults += filteredCharges.length; // Update total results

    filteredCharges.forEach(item => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${hospitalName}</td>
        <td>${hospitalAddress}</td>
        <td>${item.desc}</td>
        <td>${item.cost !== undefined ? `$${item.cost.toFixed(2)}` : 'N/A'}</td>
        <td>N/A</td> <!-- Placeholder for missing properties -->
        <td>N/A</td>
        <td>N/A</td>
        <td>N/A</td>
      `;
      resultsTableBody.appendChild(row);
    });
  });

  resultCount.textContent = `Results found: ${totalResults}`;

  if (totalResults === 0) {
    resultsTableBody.innerHTML = `<tr><td colspan="8">No results found for "${query}"</td></tr>`;
  }
}

  searchForm.addEventListener('submit', (event) => {
    event.preventDefault();
    const query = queryInput.value.trim();
    if (query) {
      displayResults(query);
    }
  });

  </script>
</body>
</html>
